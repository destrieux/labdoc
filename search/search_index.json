{"config":{"indexing":"full","lang":["fr"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Ce site liste les protocoles du labo","title":"Home"},{"location":"Exvivo/Reconstruction/reconstruction/","text":"Surface reconstruction from exvivo MRI \u00b6 This document describes the steps required to reconstruct the cortical surface from a multi-flash multi-echo acquisition (MGH protocol). STEP 0 : edit and run the 00_params.csh script \u00b6 This file defines the paths used by all subsequent scripts. It is located in in the _scripts_templates/ directory Edit the script with the following information \u00b6 ** Path to the directory containing the DICOM series ($dicom_dir)** This directory typically contains 2 series per flip angle (FA) (MEFLASH_FA10_0002 and MEFLASH_FA10_0003 for amplitude and phase, respectively). Each FA series contains one volume per echo, typically 10 echos. Path to the directory containing reconstructions for all subjects ($root_recon_dir/) Subjects's name ($subj) , for instance FIBRATLAS_XX-XXX_EXV List of echo times (TE) ($telist) Open one of the flip angle series in Horos (e.g., MEFLASH_FA10_0002); This displays 10 volumes, one per echo time. For each volume search for the EchoTime value in metadata. In Tours, this is usually : (2.64 4.50 6.36 8.22 10.08 11.94 13.80 15.66 17.52 19.38). Flip Angle values defined by two variables, ($falist_ref1 and $falist_ref2) This allows recombination of images acquired in two sessions: $falist_ref1: FA values for the first session $falist_ref2: FA values for the second session f only one session was performed, comment out $falist_ref2 Typical FA values are: 10 20 30 40 50. Run the script \u00b6 cd _scripts_template ./00_params.csh The script creates the following directories if they do not already exist: $root_recon_dir/ \u251c\u2500\u2500 mri/ : raw data in mgz format, original orientation \u251c\u2500\u2500 rotated/ : data rotated to standard orientation \u2502 \u251c\u2500\u2500 vol2vol/ : rotated raw data (.mgz) \u2502 \u251c\u2500\u2500 split/ : individual TE volumes, rotated \u2502 \u2514\u2500\u2500 parameter_maps/ : T1, T2*, PD maps, rotated \u2514\u2500\u2500 scripts/ : reconstruction scripts (automatically copied here) These directories will be populated in the next steps. STEP 1 : convert DICOM files to mgz format. \u00b6 Make sure you are in the < subject >/script/ directory before running : ./01_convert_MEFLASH_dicom_toMGZ.tcsh This script converts the original DICOM to .mgz format, and stores the results in the mri/ directory: One .mgz file is created per FA, Each .mgz file contains the 10 echos. The script looks for a file matching the pattern: .????.0001. .IMA For example, MEFLASH_FA10_0002/FIBRATLAS_01-14.MR.PROTOCOLES_INSTITUTIONNELS_FIBRATLAS.0002.0001.2021.02.09.15.46.09.318041.70332665.IMA Where: - * corresponds to MEFLASH_FA10_0002/FIBRATLAS_01-14.MR.PROTOCOLES_INSTITUTIONNELS_FIBRATLAS - ???? corresponds to 0002 (series #2) - *.IMA corresponds to .2021.02.09.15.46.09.318041.70332665.IMA STEP 2: Rotate volumes and split echoes \u00b6 Rotate one volume \u00b6 Before running the script, open one volume from < subject >/mri/ in Freeview Select the first volume of a given flip angle (amplitude) as the second contains phase information. Example: cd < subject >/mri/ freeview MEFLASH_FA30_00??.mgz $FREESURFER_HOME/average/mni305.cor.mgz:colormap=heat:opacity=0.5 his overlays the volume onto an average brain to determine the correct orientation. Ensure that the selected volume is the acquisition to rotate, not the atlas! In Freeview, use Tools > Transform volume to adjust orientation (rotation only: no scaling or translation): Usually about 80\u00b0 for X, no rotation for Y, 180\u00b0 for Z Beware the Right-Left orientation: In axial view, the letters shown at the bottom of the view should appear on the left side of the image and appear flipped. Save the volumes in mri/ as rotation_template.mgz * (this name can be changed in 00_params.csh ) This produces the reoriented volume ( rotation_template.mgz ) and the related transformation ( rotation_template.mgz.lta ) Run the script \u00b6 cd <subject>/scripts/ 02_rotate_split.csh This script : Creates a rotated file per FA in mri/rotated/vol2vol/ aligned to rotation_template.mgz , Uses only the amplitude images (phase is ignored) Splits each rotated FA volume into 10 echo volumes in rotated/split/ , for instance MEFLASH_FA10_0002.rot0000.mgz to MEFLASH_FA10_0002.rot0009.mgz. FAssigns the correct TE value to each echo. Compute flash 10-50, PD, T1, SSE, T2 maps usin Bloch's equations. Results are saved in rotated/parameter_maps/ . STEP 3 : Create and apply masks \u00b6 Determine threshold values \u00b6 cd <subject>/rotated/parameter_maps/ freeview PD.mgz T1.mgz T2star.mgz In Freeview, use Tools > Threshold volume to determine: PDThresh : minimum value in PD.mgz to include brain and fluid while excluding air and the container, Produces PD.th.ocn.mgz by keeping only voxels above PDThresh (brain and fluid) and belonging to a cluster > 4000 voxels T2sThresh : maximum value in T2star.mgz for voxels belonging to brain air Produces T2s.th.ocn.mgz by keeping only voxels below T2sThresh (brain and air) and belonging to a cluster > 4000 voxels T1Thresh : minimum value in T1.mgz for voxels belonging to fluid In Out Filename i > PDThresh Brain + Fluid Air + Box PD.th.ocn.mgz i < T2sThresh Brain + Air Fluid T2s.th.ocn.mgz i > T1Thresh Fluid Brain + Air T2s.th.ocn.mgz Edit these values into 03_create_masks.csh Run the script \u00b6 cd <subject>/scripts/ 03_create_masks.csh Check the output \u00b6 cd <subject>/rotated/parameter_maps freeview PD.mgz brainmask.bb.mgz:colormap=heat:opacity=0.3 PD.bb.maskedn.conf+noise.gstd1abs.mgz:colormap=jet:opacity=0.3 Verify that brainmask.bb.mgz and PD.bb.maskedn.conf+noise.gstd1abs.mgz contain the whole brain and only brain voxels. If not, adjust the thresholds and rerun the script, you may run individual commands to to fine-tune values. cd <subject>/rotated/parameter_maps/ freeview PD.mgz PD.th.ocn.mgz:colormap=lut:opacity=0.3 T2s.th.ocn.mgz:colormap=lut:opacity=0.3 fluid.mgz:colormap=heat:opacity=0.3 Normally you expect the voxels value for the different masks created during the process to follow this table: Air Box Brain Fluid PD.th.ocn.mgz 0 0 1 1 fluid.mgz. 0 0 0 1 T2s.th.ocn.mgz 1 0/1 1 0 cd <subject>/rotated/parameter_maps freeview PD.mgz fluid.not.mgz:colormap=heat:opacity=0.3 PD.th.ocn.mgz:colormap=jet:opacity=0.3 T2s.th.ocn.mgz:colormap=pet:opacity=0.3 STEP 4: Run samseg \u00b6 Run the script \u00b6 cd <subject>/scripts ./04_runsamseg.csh samseg segments the brain in large compartments and computes an unbiased version of the PD image. The script calls : samseg --i PD.bb.maskedn.conf+noise.gstd1abs.mgz \\ --exvivo \\ --o samseg.PD.bb.maskedn.conf+noise.gstd1abs \\ --save-posteriors \\ --save-probabilities \\ --threads 4 With : --i[nput], i.e. the masked PD volume --o[utput] samseg.PD.bb.maskedn : output directory, which contains seg.mgz : anatomical label assigned to each voxel samseg.stats : estimated volume of each class (mm^3) mode0X_bias_corrected.mgz (with X=1,2,...): the bias field corrected MRI volume corresponding for each input contrast. Since we only input PD, mode01_bias_corrected.mgz is the bias corrected PD mode0X_bias_field.mgz (with X=1,2,...): estimated bias field for each input contrast --threads 4 : number of CPU cores to use --save-posteriors : saves posterior probability maps --save-probabilities : aves posterior, prior, and likelihood maps as 3-frame volumes for each tissue type --gmm exvivo.NoCblum.sharedGMMParameters.txt: groups segmented structures into superstructures (WM, GM, etc.). By default it uses $FREESURFER_HOME//average/samseg/20Subjects_smoothing2_down2_smoothingForAffine2. You can specify another file to change the superstructures definition. Check the result \u00b6 cd <subject>/rotated/parameter_maps/samseg.PD.bb.maskedn.conf+noise.gstd1abs freeview mode01_bias_corrected.mgz seg.mgz:colormap=lut:opacity=0.4 Check whether the gray/white matter segmentation is correct. If the segmentation is not satisfactory Option 1: Run SAMSEG without added noise Use PD.bb.maskedn.conf.mgz (output of step 3 without noise) in 04_runsamseg.csh, modify the samseg command to: samseg --i PD.bb.maskedn.conf.mgz \\ --exvivo \\ --o samseg.PD.bb.maskedn.conf.gstd1abs \\ --save-posteriors \\ --save-probabilities \\ --threads 4 in 05_runmmppsp.csh, modify the command input and output as follow: csh ../../scripts/mmppsp.txt --samseg samseg.PD.bb.maskedn.conf.gstd1abs \\ --posterior \\ --o samseg.PD.bb.maskedn.conf.gstd1abs/${subj}.recon \\ --threads 4 2/ rerun the end of step 3, keeping the image's original dynamics. cd <subject>/rotated/parameter_maps/ mri_convert PD.bb.maskedn.mgz --conform \\ --no_scale 1 \\ -odt float PD.bb.maskedn.conf.mgz mri_binarize --min .0001 \\ --i PD.bb.maskedn.conf.mgz \\ --o PD.bb.maskedn.conf.mask.inv.mgz \\ --inv <br />mri_volsynth \\ --template PD.bb.maskedn.conf.mgz \\ --gstd 1 \\ --o noise.gstd1abs.mgz \\ --abs fscalc noise.gstd1abs.mgz \\ mul PD.bb.maskedn.conf.mask.inv.mgz \\ sum PD.bb.maskedn.conf.mgz \\ -o PD.bb.maskedn.conf+noise.gstd1abs.mgz STEP 5: run mmppsp \u00b6 Run the script \u00b6 cd <subject>/scripts ./05_runmmppsp.csh This step is similar to an in vivo recon-all; it creates various mri, surf, and labels files for the subject and stores them in: samseg.PD.bb.maskedn.conf+noise.gstd1abs/${subj}.recon It runs : csh ../../scripts/mmppsp.txt --samseg samseg.PD.bb.maskedn.conf+noise.gstd1abs \\ --posterior \\ --o samseg.PD.bb.maskedn.conf+noise.gstd1abs/FIBRATLAS_01-014_EXV.recon \\ --threads 4 With : --samseg samseg.PD.bb.maskedn.conf+noise.gstd1abs : directory where the samseg output is located --posterior uses posterior from samseg --o samseg.PD.bb.maskedn.conf+noise.gstd1abs/${subj}.recon : output directory --threads 4 : number of processor to use in parallel Check the output \u00b6 cd <subject>/rotated/parameter_maps/samseg.PD.bb.maskedn.conf+noise.gstd1abs/${subj}.recon freeview mri/norm.mgz mri/wm.mgz:colormap=lut \\ --hide-3d-slices \\ --layout 4 \\ --viewport 3d \\ -f surf/*h.white \\ -f surf/*h.inflated Check that the gray\u2013white matter interface is correct. White matter is often missing in frontobasal and temporobasal regions. Inspect the rh.white and lh.white surface for small bumps and play with the wm.mgz transparency. These are usually caused by air bubbles; their periphery often has signal intensity similar to white matter and may be incorrectly included. Use the recon tool to fill the air bubble with value 1. Do not use 0, otherwise the edits will be lost when rerunning mmppsp. Run the script again \u00b6 cd <subject>/scripts ./05_runmmppsp.csh","title":"Ex vivo surface recon "},{"location":"Exvivo/Reconstruction/reconstruction/#surface-reconstruction-from-exvivo-mri","text":"This document describes the steps required to reconstruct the cortical surface from a multi-flash multi-echo acquisition (MGH protocol).","title":"Surface reconstruction from exvivo MRI"},{"location":"Exvivo/Reconstruction/reconstruction/#step-0-edit-and-run-the-00_paramscsh-script","text":"This file defines the paths used by all subsequent scripts. It is located in in the _scripts_templates/ directory","title":"STEP 0 : edit and run the 00_params.csh script"},{"location":"Exvivo/Reconstruction/reconstruction/#edit-the-script-with-the-following-information","text":"** Path to the directory containing the DICOM series ($dicom_dir)** This directory typically contains 2 series per flip angle (FA) (MEFLASH_FA10_0002 and MEFLASH_FA10_0003 for amplitude and phase, respectively). Each FA series contains one volume per echo, typically 10 echos. Path to the directory containing reconstructions for all subjects ($root_recon_dir/) Subjects's name ($subj) , for instance FIBRATLAS_XX-XXX_EXV List of echo times (TE) ($telist) Open one of the flip angle series in Horos (e.g., MEFLASH_FA10_0002); This displays 10 volumes, one per echo time. For each volume search for the EchoTime value in metadata. In Tours, this is usually : (2.64 4.50 6.36 8.22 10.08 11.94 13.80 15.66 17.52 19.38). Flip Angle values defined by two variables, ($falist_ref1 and $falist_ref2) This allows recombination of images acquired in two sessions: $falist_ref1: FA values for the first session $falist_ref2: FA values for the second session f only one session was performed, comment out $falist_ref2 Typical FA values are: 10 20 30 40 50.","title":"Edit the script with the following information"},{"location":"Exvivo/Reconstruction/reconstruction/#run-the-script","text":"cd _scripts_template ./00_params.csh The script creates the following directories if they do not already exist: $root_recon_dir/ \u251c\u2500\u2500 mri/ : raw data in mgz format, original orientation \u251c\u2500\u2500 rotated/ : data rotated to standard orientation \u2502 \u251c\u2500\u2500 vol2vol/ : rotated raw data (.mgz) \u2502 \u251c\u2500\u2500 split/ : individual TE volumes, rotated \u2502 \u2514\u2500\u2500 parameter_maps/ : T1, T2*, PD maps, rotated \u2514\u2500\u2500 scripts/ : reconstruction scripts (automatically copied here) These directories will be populated in the next steps.","title":"Run the script"},{"location":"Exvivo/Reconstruction/reconstruction/#step-1-convert-dicom-files-to-mgz-format","text":"Make sure you are in the < subject >/script/ directory before running : ./01_convert_MEFLASH_dicom_toMGZ.tcsh This script converts the original DICOM to .mgz format, and stores the results in the mri/ directory: One .mgz file is created per FA, Each .mgz file contains the 10 echos. The script looks for a file matching the pattern: .????.0001. .IMA For example, MEFLASH_FA10_0002/FIBRATLAS_01-14.MR.PROTOCOLES_INSTITUTIONNELS_FIBRATLAS.0002.0001.2021.02.09.15.46.09.318041.70332665.IMA Where: - * corresponds to MEFLASH_FA10_0002/FIBRATLAS_01-14.MR.PROTOCOLES_INSTITUTIONNELS_FIBRATLAS - ???? corresponds to 0002 (series #2) - *.IMA corresponds to .2021.02.09.15.46.09.318041.70332665.IMA","title":"STEP 1 : convert DICOM files to mgz format."},{"location":"Exvivo/Reconstruction/reconstruction/#step-2-rotate-volumes-and-split-echoes","text":"","title":"STEP 2: Rotate volumes and split echoes"},{"location":"Exvivo/Reconstruction/reconstruction/#rotate-one-volume","text":"Before running the script, open one volume from < subject >/mri/ in Freeview Select the first volume of a given flip angle (amplitude) as the second contains phase information. Example: cd < subject >/mri/ freeview MEFLASH_FA30_00??.mgz $FREESURFER_HOME/average/mni305.cor.mgz:colormap=heat:opacity=0.5 his overlays the volume onto an average brain to determine the correct orientation. Ensure that the selected volume is the acquisition to rotate, not the atlas! In Freeview, use Tools > Transform volume to adjust orientation (rotation only: no scaling or translation): Usually about 80\u00b0 for X, no rotation for Y, 180\u00b0 for Z Beware the Right-Left orientation: In axial view, the letters shown at the bottom of the view should appear on the left side of the image and appear flipped. Save the volumes in mri/ as rotation_template.mgz * (this name can be changed in 00_params.csh ) This produces the reoriented volume ( rotation_template.mgz ) and the related transformation ( rotation_template.mgz.lta )","title":"Rotate one volume"},{"location":"Exvivo/Reconstruction/reconstruction/#run-the-script_1","text":"cd <subject>/scripts/ 02_rotate_split.csh This script : Creates a rotated file per FA in mri/rotated/vol2vol/ aligned to rotation_template.mgz , Uses only the amplitude images (phase is ignored) Splits each rotated FA volume into 10 echo volumes in rotated/split/ , for instance MEFLASH_FA10_0002.rot0000.mgz to MEFLASH_FA10_0002.rot0009.mgz. FAssigns the correct TE value to each echo. Compute flash 10-50, PD, T1, SSE, T2 maps usin Bloch's equations. Results are saved in rotated/parameter_maps/ .","title":"Run the script"},{"location":"Exvivo/Reconstruction/reconstruction/#step-3-create-and-apply-masks","text":"","title":"STEP 3 : Create and apply masks"},{"location":"Exvivo/Reconstruction/reconstruction/#determine-threshold-values","text":"cd <subject>/rotated/parameter_maps/ freeview PD.mgz T1.mgz T2star.mgz In Freeview, use Tools > Threshold volume to determine: PDThresh : minimum value in PD.mgz to include brain and fluid while excluding air and the container, Produces PD.th.ocn.mgz by keeping only voxels above PDThresh (brain and fluid) and belonging to a cluster > 4000 voxels T2sThresh : maximum value in T2star.mgz for voxels belonging to brain air Produces T2s.th.ocn.mgz by keeping only voxels below T2sThresh (brain and air) and belonging to a cluster > 4000 voxels T1Thresh : minimum value in T1.mgz for voxels belonging to fluid In Out Filename i > PDThresh Brain + Fluid Air + Box PD.th.ocn.mgz i < T2sThresh Brain + Air Fluid T2s.th.ocn.mgz i > T1Thresh Fluid Brain + Air T2s.th.ocn.mgz Edit these values into 03_create_masks.csh","title":"Determine threshold values"},{"location":"Exvivo/Reconstruction/reconstruction/#run-the-script_2","text":"cd <subject>/scripts/ 03_create_masks.csh","title":"Run the script"},{"location":"Exvivo/Reconstruction/reconstruction/#check-the-output","text":"cd <subject>/rotated/parameter_maps freeview PD.mgz brainmask.bb.mgz:colormap=heat:opacity=0.3 PD.bb.maskedn.conf+noise.gstd1abs.mgz:colormap=jet:opacity=0.3 Verify that brainmask.bb.mgz and PD.bb.maskedn.conf+noise.gstd1abs.mgz contain the whole brain and only brain voxels. If not, adjust the thresholds and rerun the script, you may run individual commands to to fine-tune values. cd <subject>/rotated/parameter_maps/ freeview PD.mgz PD.th.ocn.mgz:colormap=lut:opacity=0.3 T2s.th.ocn.mgz:colormap=lut:opacity=0.3 fluid.mgz:colormap=heat:opacity=0.3 Normally you expect the voxels value for the different masks created during the process to follow this table: Air Box Brain Fluid PD.th.ocn.mgz 0 0 1 1 fluid.mgz. 0 0 0 1 T2s.th.ocn.mgz 1 0/1 1 0 cd <subject>/rotated/parameter_maps freeview PD.mgz fluid.not.mgz:colormap=heat:opacity=0.3 PD.th.ocn.mgz:colormap=jet:opacity=0.3 T2s.th.ocn.mgz:colormap=pet:opacity=0.3","title":"Check the output"},{"location":"Exvivo/Reconstruction/reconstruction/#step-4-run-samseg","text":"","title":"STEP 4: Run samseg"},{"location":"Exvivo/Reconstruction/reconstruction/#run-the-script_3","text":"cd <subject>/scripts ./04_runsamseg.csh samseg segments the brain in large compartments and computes an unbiased version of the PD image. The script calls : samseg --i PD.bb.maskedn.conf+noise.gstd1abs.mgz \\ --exvivo \\ --o samseg.PD.bb.maskedn.conf+noise.gstd1abs \\ --save-posteriors \\ --save-probabilities \\ --threads 4 With : --i[nput], i.e. the masked PD volume --o[utput] samseg.PD.bb.maskedn : output directory, which contains seg.mgz : anatomical label assigned to each voxel samseg.stats : estimated volume of each class (mm^3) mode0X_bias_corrected.mgz (with X=1,2,...): the bias field corrected MRI volume corresponding for each input contrast. Since we only input PD, mode01_bias_corrected.mgz is the bias corrected PD mode0X_bias_field.mgz (with X=1,2,...): estimated bias field for each input contrast --threads 4 : number of CPU cores to use --save-posteriors : saves posterior probability maps --save-probabilities : aves posterior, prior, and likelihood maps as 3-frame volumes for each tissue type --gmm exvivo.NoCblum.sharedGMMParameters.txt: groups segmented structures into superstructures (WM, GM, etc.). By default it uses $FREESURFER_HOME//average/samseg/20Subjects_smoothing2_down2_smoothingForAffine2. You can specify another file to change the superstructures definition.","title":"Run the script"},{"location":"Exvivo/Reconstruction/reconstruction/#check-the-result","text":"cd <subject>/rotated/parameter_maps/samseg.PD.bb.maskedn.conf+noise.gstd1abs freeview mode01_bias_corrected.mgz seg.mgz:colormap=lut:opacity=0.4 Check whether the gray/white matter segmentation is correct. If the segmentation is not satisfactory Option 1: Run SAMSEG without added noise Use PD.bb.maskedn.conf.mgz (output of step 3 without noise) in 04_runsamseg.csh, modify the samseg command to: samseg --i PD.bb.maskedn.conf.mgz \\ --exvivo \\ --o samseg.PD.bb.maskedn.conf.gstd1abs \\ --save-posteriors \\ --save-probabilities \\ --threads 4 in 05_runmmppsp.csh, modify the command input and output as follow: csh ../../scripts/mmppsp.txt --samseg samseg.PD.bb.maskedn.conf.gstd1abs \\ --posterior \\ --o samseg.PD.bb.maskedn.conf.gstd1abs/${subj}.recon \\ --threads 4 2/ rerun the end of step 3, keeping the image's original dynamics. cd <subject>/rotated/parameter_maps/ mri_convert PD.bb.maskedn.mgz --conform \\ --no_scale 1 \\ -odt float PD.bb.maskedn.conf.mgz mri_binarize --min .0001 \\ --i PD.bb.maskedn.conf.mgz \\ --o PD.bb.maskedn.conf.mask.inv.mgz \\ --inv <br />mri_volsynth \\ --template PD.bb.maskedn.conf.mgz \\ --gstd 1 \\ --o noise.gstd1abs.mgz \\ --abs fscalc noise.gstd1abs.mgz \\ mul PD.bb.maskedn.conf.mask.inv.mgz \\ sum PD.bb.maskedn.conf.mgz \\ -o PD.bb.maskedn.conf+noise.gstd1abs.mgz","title":"Check the result"},{"location":"Exvivo/Reconstruction/reconstruction/#step-5-run-mmppsp","text":"","title":"STEP 5: run mmppsp"},{"location":"Exvivo/Reconstruction/reconstruction/#run-the-script_4","text":"cd <subject>/scripts ./05_runmmppsp.csh This step is similar to an in vivo recon-all; it creates various mri, surf, and labels files for the subject and stores them in: samseg.PD.bb.maskedn.conf+noise.gstd1abs/${subj}.recon It runs : csh ../../scripts/mmppsp.txt --samseg samseg.PD.bb.maskedn.conf+noise.gstd1abs \\ --posterior \\ --o samseg.PD.bb.maskedn.conf+noise.gstd1abs/FIBRATLAS_01-014_EXV.recon \\ --threads 4 With : --samseg samseg.PD.bb.maskedn.conf+noise.gstd1abs : directory where the samseg output is located --posterior uses posterior from samseg --o samseg.PD.bb.maskedn.conf+noise.gstd1abs/${subj}.recon : output directory --threads 4 : number of processor to use in parallel","title":"Run the script"},{"location":"Exvivo/Reconstruction/reconstruction/#check-the-output_1","text":"cd <subject>/rotated/parameter_maps/samseg.PD.bb.maskedn.conf+noise.gstd1abs/${subj}.recon freeview mri/norm.mgz mri/wm.mgz:colormap=lut \\ --hide-3d-slices \\ --layout 4 \\ --viewport 3d \\ -f surf/*h.white \\ -f surf/*h.inflated Check that the gray\u2013white matter interface is correct. White matter is often missing in frontobasal and temporobasal regions. Inspect the rh.white and lh.white surface for small bumps and play with the wm.mgz transparency. These are usually caused by air bubbles; their periphery often has signal intensity similar to white matter and may be incorrectly included. Use the recon tool to fill the air bubble with value 1. Do not use 0, otherwise the edits will be lost when rerunning mmppsp.","title":"Check the output"},{"location":"Exvivo/Reconstruction/reconstruction/#run-the-script-again","text":"cd <subject>/scripts ./05_runmmppsp.csh","title":"Run the script again"},{"location":"Photogrammetry/From_metashape_to_SKN3D/","text":"Protocol for preparing images for import into Sketchnote 3D Open the model in Metashape \u00b6 Reorient the object \u00b6 The model initially appears in top view Rotate Object displays a wheel that allows the model to be moved while the axes (windows bottom right)remain fixed: align Z upward, Y backward, and X to the left Then display the side of the model : Model > Predefined views > Left This displays the model's RIGHT side; this is normal. Use Rotate Object again to align the object with the axes Repeat in Front and Back views Adjust the bounding box \u00b6 Model > Predefined views > Top Region > Rotate region to local frame * Resize the region to enclose the object Export \u00b6 File > Export > Export model as GLB file Make sure that Export texture and Vertex normals are checked, otherwise the texture will not display automatically. Open the model in Blender \u00b6 Unfortunately metashape cannot export export compressed glb files. Fichier > Importer > GLTF In Collection de la Sc\u00e8ne (windows right upper corner) delete the cube (right click) Fichier > Exporter GLTF Under Donn\u00e9es check Compression","title":"From metashape to SKN3D"},{"location":"Photogrammetry/From_metashape_to_SKN3D/#open-the-model-in-metashape","text":"","title":"Open the model in Metashape"},{"location":"Photogrammetry/From_metashape_to_SKN3D/#reorient-the-object","text":"The model initially appears in top view Rotate Object displays a wheel that allows the model to be moved while the axes (windows bottom right)remain fixed: align Z upward, Y backward, and X to the left Then display the side of the model : Model > Predefined views > Left This displays the model's RIGHT side; this is normal. Use Rotate Object again to align the object with the axes Repeat in Front and Back views","title":"Reorient the object"},{"location":"Photogrammetry/From_metashape_to_SKN3D/#adjust-the-bounding-box","text":"Model > Predefined views > Top Region > Rotate region to local frame * Resize the region to enclose the object","title":"Adjust the bounding box"},{"location":"Photogrammetry/From_metashape_to_SKN3D/#export","text":"File > Export > Export model as GLB file Make sure that Export texture and Vertex normals are checked, otherwise the texture will not display automatically.","title":"Export"},{"location":"Photogrammetry/From_metashape_to_SKN3D/#open-the-model-in-blender","text":"Unfortunately metashape cannot export export compressed glb files. Fichier > Importer > GLTF In Collection de la Sc\u00e8ne (windows right upper corner) delete the cube (right click) Fichier > Exporter GLTF Under Donn\u00e9es check Compression","title":"Open the model in Blender"},{"location":"Procedures/TP_moodle/","text":"Cette note explique comment g\u00e9rer les TP d'anatomie avec C\u00e9lene/Moodle L'objectif est : que les \u00e9tudiants s'inscrivent dans des groupes comme ils le souhaitent ; ils peuvent \u00e9changer entre aux sans intervention des enseignants. que les \u00e9tudiants valident leur pr\u00e9sence en flashant un QR code rotatif (pas besoin de feuille d'appel) que la feuille de pr\u00e9sence soit g\u00e9n\u00e9r\u00e9e automatiquement. Gestion des groupes \u00b6 Pr\u00e9paration des groupes (\u00e0 faire une fois pour toutes) \u00b6 Cr\u00e9ez un groupe d'\u00e9tudiants par s\u00e9ance de TP : \u00b6 Dans G\u00e9rer > Cr\u00e9er un groupe : Renseigner le nom du groupe sur le mod\u00e8le Cardio - S\u00e9ance O1 N'utilisez pas de dates sinon vous devrez changer le nom des groupes chaque ann\u00e9e Ici, un pdf listant les dates par s\u00e9ance est fourni aux \u00e9tudiant Regroupez les groupes en groupements \u00b6 Dans Cr\u00e9er un groupement d\u00e9finir son nom, par exemple TP Cardio Sur la ligne de ce groupement cliquez sur l'icone visage pour ajouter des groupes au groupement en les faisant glisser entre les deux colonnes. Cr\u00e9ez une activit\u00e9 de type Choix de groupe (\u00e0 faire une fois pour toutes) \u00b6 Ajoutez cette activit\u00e9 dans le cours ; elle permet aux \u00e9tudiants de s'inscrire \u00e0 un groupe Remplissez : Le nom du choix de groupe, par exemple Choissez vos s\u00e9ances de TP de Cardio Publier les r\u00e9sultats : Toujours afficher les r\u00e9sultats aux \u00e9tudiants Confidentialit\u00e9 des r\u00e9sultats : Publier les r\u00e9sultats complets (permet aux \u00e9tudiants de trouver ceux qui peuvent \u00e9changer) Autoriser la modification du choix : Oui ; si un \u00e9tudiant veut changer, il doit se d\u00e9sinscrire et s'inscrire dans un autre groupe dans lequel il reste des places Limiter le nombre de r\u00e9ponses : Activer ; indiquez ici le nombre maximum de participants par groupe Cliquez Appliquez \u00e0 tous les groupes Dans Groupes ajouter le groupement correspondant \u00e0 ce TP, par exemple TP Cardio Enregistrez Pour voir les \u00e9tudiants inscrits \u00e0 une s\u00e9ance \u00b6 afficher la liste des participants et filtrez sur le nom du groupe Pr\u00e9paration de l'appel \u00b6 L'appel utlise une activit\u00e9 Pr\u00e9sence qui doit \u00eatre ajout\u00e9e au cours Param\u00e9trage manuel de Pr\u00e9sence \u00b6 Donner un nom \u00e0 l'activit\u00e9, par exemple Appel L'onglet Pr\u00e9sence liste les s\u00e9ances. Vous pouvez ajouter une session : Type : Groupe d'\u00e9tudiant : associer un groupe \u00e0 cette session Entrez la date et les heures de debut et de fin Saisie par \u00e9tudiant : cocher Permettre aux \u00e9tudiants de renseigner eux m\u00eame leur pr\u00e9sence Ouverture anticip\u00e9e : permet aux \u00e9tudiants de valider leur pr\u00e9sence avant le d\u00e9but de la s\u00e9ance pour ne pas perdre de temps ; par exemple 10 minutes Cochez Code QR rotatif (un nouveau code est pr\u00e9sent\u00e9 toutes les minutes) ou Code QR (fixe qui peut \u00eatre imprim\u00e9) Cliquez Ajouter Import des sessions (\u00e0 faire chaque ann\u00e9e) \u00b6 La proc\u00e9dure d\u00e9crite ci-dessus n'est pas utilisable si de nombreuses sessions doivent \u00eatre entr\u00e9es ; de plus il faut changer les dates chaque ann\u00e9e. Il est possible d'importer les s\u00e9ances via un fichier csv Pr\u00e9paration du fichier csv \u00b6 Groupes Date De \u00e0 Description Aucun Aucun Aucun autoinsc Aucun Aucun Aucun Aucun Aucun Aucun Aucun Aucun Aucun Aucun Aucun Code QR rotatif pr\u00e9ouverture G\u00e9nito-U - s\u00e9ance 01 23-03-2026 09:00 10:00 TP g\u00e9nito urinaire 1 1 600 G\u00e9nito-U - s\u00e9ance 02 23-03-2026 10:00 11:00 TP g\u00e9nito urinaire 1 1 600 Groupe : groupe attach\u00e9 \u00e0 cette session Date : date de la session De : d\u00e9but de la session \u00e0 : fin de la session Description : champ libre d\u00e9crivant la session Autoinsc : permet \u00e0 l'\u00e9tudiant de s'auto inscrire Code QR Rotatif : 1 ajoute le code QR pr\u00e9ouverture en secondes Aucun : param\u00e8tres non utilis\u00e9s ; ces colonnes peuvent \u00eatre supprim\u00e9es mais leur pr\u00e9sence failite les imports \u00e0 l'\u00e9tape suivante Sauvegardez avec un d\u00e9limiteur ; (utilisez libre office plutot que excell) Import du ficher csv \u00b6 Dans l'activit\u00e9 pr\u00e9sence, allez \u00e0 l'onglet Importer Choisir le fichier que vous venez de cr\u00e9er et IMPORTER Si vous avez entr\u00e9 les colonnes vides dans le fichier, la correspondance entre les valeurs attendues et les noms de champs dans le fichier doit \u00eatre correcte. Confirmer ; les s\u00e9naces sont cr\u00e9es. Faire l'appel (\u00e0 chaque s\u00e9ance) \u00b6 Le jour de la s\u00e9ance : \u00b6 allez dans l'activit\u00e9 pr\u00e9sence du cours > onglet Pr\u00e9sence pour la s\u00e9ance du jour, cliquez sur la fl\u00e8che \"play\" un tableau de bord s'affiche avec les \u00e9tudiants attendus si besoin vous pouvez les noter pr\u00e9sents absents ou excus\u00e9s auto inscription \u00b6 cliquez sur afficher le code QR Les \u00e9tudiants flashent le code, s'identifient sur celene ce qui valide leur pr\u00e9sence l'inscription n'est possible que : - si l'heure de la s\u00e9ance est correcte - si l'\u00e9tudiant fait partie du groupe attach\u00e9 \u00e0 la s\u00e9ance apres la s\u00e9ance \u00b6 *cliquez sur la fleche verte qui remplace le bouton PLAY vous obtenez le tableau des pr\u00e9sents","title":"Appel avec Moodle/C\u00e9lene"},{"location":"Procedures/TP_moodle/#gestion-des-groupes","text":"","title":"Gestion des groupes"},{"location":"Procedures/TP_moodle/#preparation-des-groupes-a-faire-une-fois-pour-toutes","text":"","title":"Pr\u00e9paration des groupes (\u00e0 faire une fois pour toutes)"},{"location":"Procedures/TP_moodle/#creez-un-groupe-detudiants-par-seance-de-tp","text":"Dans G\u00e9rer > Cr\u00e9er un groupe : Renseigner le nom du groupe sur le mod\u00e8le Cardio - S\u00e9ance O1 N'utilisez pas de dates sinon vous devrez changer le nom des groupes chaque ann\u00e9e Ici, un pdf listant les dates par s\u00e9ance est fourni aux \u00e9tudiant","title":"Cr\u00e9ez un groupe d'\u00e9tudiants par s\u00e9ance de TP :"},{"location":"Procedures/TP_moodle/#regroupez-les-groupes-en-groupements","text":"Dans Cr\u00e9er un groupement d\u00e9finir son nom, par exemple TP Cardio Sur la ligne de ce groupement cliquez sur l'icone visage pour ajouter des groupes au groupement en les faisant glisser entre les deux colonnes.","title":"Regroupez les groupes en groupements"},{"location":"Procedures/TP_moodle/#creez-une-activite-de-type-choix-de-groupe-a-faire-une-fois-pour-toutes","text":"Ajoutez cette activit\u00e9 dans le cours ; elle permet aux \u00e9tudiants de s'inscrire \u00e0 un groupe Remplissez : Le nom du choix de groupe, par exemple Choissez vos s\u00e9ances de TP de Cardio Publier les r\u00e9sultats : Toujours afficher les r\u00e9sultats aux \u00e9tudiants Confidentialit\u00e9 des r\u00e9sultats : Publier les r\u00e9sultats complets (permet aux \u00e9tudiants de trouver ceux qui peuvent \u00e9changer) Autoriser la modification du choix : Oui ; si un \u00e9tudiant veut changer, il doit se d\u00e9sinscrire et s'inscrire dans un autre groupe dans lequel il reste des places Limiter le nombre de r\u00e9ponses : Activer ; indiquez ici le nombre maximum de participants par groupe Cliquez Appliquez \u00e0 tous les groupes Dans Groupes ajouter le groupement correspondant \u00e0 ce TP, par exemple TP Cardio Enregistrez","title":"Cr\u00e9ez une activit\u00e9 de type Choix de groupe (\u00e0 faire une fois pour toutes)"},{"location":"Procedures/TP_moodle/#pour-voir-les-etudiants-inscrits-a-une-seance","text":"afficher la liste des participants et filtrez sur le nom du groupe","title":"Pour voir les \u00e9tudiants inscrits \u00e0 une s\u00e9ance"},{"location":"Procedures/TP_moodle/#preparation-de-lappel","text":"L'appel utlise une activit\u00e9 Pr\u00e9sence qui doit \u00eatre ajout\u00e9e au cours","title":"Pr\u00e9paration de l'appel"},{"location":"Procedures/TP_moodle/#parametrage-manuel-de-presence","text":"Donner un nom \u00e0 l'activit\u00e9, par exemple Appel L'onglet Pr\u00e9sence liste les s\u00e9ances. Vous pouvez ajouter une session : Type : Groupe d'\u00e9tudiant : associer un groupe \u00e0 cette session Entrez la date et les heures de debut et de fin Saisie par \u00e9tudiant : cocher Permettre aux \u00e9tudiants de renseigner eux m\u00eame leur pr\u00e9sence Ouverture anticip\u00e9e : permet aux \u00e9tudiants de valider leur pr\u00e9sence avant le d\u00e9but de la s\u00e9ance pour ne pas perdre de temps ; par exemple 10 minutes Cochez Code QR rotatif (un nouveau code est pr\u00e9sent\u00e9 toutes les minutes) ou Code QR (fixe qui peut \u00eatre imprim\u00e9) Cliquez Ajouter","title":"Param\u00e9trage manuel de Pr\u00e9sence"},{"location":"Procedures/TP_moodle/#import-des-sessions-a-faire-chaque-annee","text":"La proc\u00e9dure d\u00e9crite ci-dessus n'est pas utilisable si de nombreuses sessions doivent \u00eatre entr\u00e9es ; de plus il faut changer les dates chaque ann\u00e9e. Il est possible d'importer les s\u00e9ances via un fichier csv","title":"Import des sessions (\u00e0 faire chaque ann\u00e9e)"},{"location":"Procedures/TP_moodle/#preparation-du-fichier-csv","text":"Groupes Date De \u00e0 Description Aucun Aucun Aucun autoinsc Aucun Aucun Aucun Aucun Aucun Aucun Aucun Aucun Aucun Aucun Aucun Code QR rotatif pr\u00e9ouverture G\u00e9nito-U - s\u00e9ance 01 23-03-2026 09:00 10:00 TP g\u00e9nito urinaire 1 1 600 G\u00e9nito-U - s\u00e9ance 02 23-03-2026 10:00 11:00 TP g\u00e9nito urinaire 1 1 600 Groupe : groupe attach\u00e9 \u00e0 cette session Date : date de la session De : d\u00e9but de la session \u00e0 : fin de la session Description : champ libre d\u00e9crivant la session Autoinsc : permet \u00e0 l'\u00e9tudiant de s'auto inscrire Code QR Rotatif : 1 ajoute le code QR pr\u00e9ouverture en secondes Aucun : param\u00e8tres non utilis\u00e9s ; ces colonnes peuvent \u00eatre supprim\u00e9es mais leur pr\u00e9sence failite les imports \u00e0 l'\u00e9tape suivante Sauvegardez avec un d\u00e9limiteur ; (utilisez libre office plutot que excell)","title":"Pr\u00e9paration du fichier csv"},{"location":"Procedures/TP_moodle/#import-du-ficher-csv","text":"Dans l'activit\u00e9 pr\u00e9sence, allez \u00e0 l'onglet Importer Choisir le fichier que vous venez de cr\u00e9er et IMPORTER Si vous avez entr\u00e9 les colonnes vides dans le fichier, la correspondance entre les valeurs attendues et les noms de champs dans le fichier doit \u00eatre correcte. Confirmer ; les s\u00e9naces sont cr\u00e9es.","title":"Import du ficher csv"},{"location":"Procedures/TP_moodle/#faire-lappel-a-chaque-seance","text":"","title":"Faire l'appel (\u00e0 chaque s\u00e9ance)"},{"location":"Procedures/TP_moodle/#le-jour-de-la-seance","text":"allez dans l'activit\u00e9 pr\u00e9sence du cours > onglet Pr\u00e9sence pour la s\u00e9ance du jour, cliquez sur la fl\u00e8che \"play\" un tableau de bord s'affiche avec les \u00e9tudiants attendus si besoin vous pouvez les noter pr\u00e9sents absents ou excus\u00e9s","title":"Le jour de la s\u00e9ance :"},{"location":"Procedures/TP_moodle/#auto-inscription","text":"cliquez sur afficher le code QR Les \u00e9tudiants flashent le code, s'identifient sur celene ce qui valide leur pr\u00e9sence l'inscription n'est possible que : - si l'heure de la s\u00e9ance est correcte - si l'\u00e9tudiant fait partie du groupe attach\u00e9 \u00e0 la s\u00e9ance","title":"auto inscription"},{"location":"Procedures/TP_moodle/#apres-la-seance","text":"*cliquez sur la fleche verte qui remplace le bouton PLAY vous obtenez le tableau des pr\u00e9sents","title":"apres la s\u00e9ance"}]}